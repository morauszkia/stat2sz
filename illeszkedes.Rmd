---
title: "Egyéb khi-négyzet próbák"
output: 
  html_document:
    toc: true
    toc_float:
      collapsed: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(huxtable)
library(dplyr)
```

A függetlenségvizsgálaton kívül még két másik esetben is olyan próbát használunk, amely nulleloszlása &chi;&sup2;. Ezek az illeszkedés- és a homogenitásvizsgálat.  



## Illeszkedésvizsgálat



Időnként azt kell megvizsgálnunk, hogy egy minta származhat-e egy bizonyos elméleti valószínűségeloszlásból. Másképpen: a mintában látható változóeloszlás illeszkedik-e valamilyen elméleti valószínűségeloszláshoz.  

Ha ez utóbbinak a paraméterei is adottak, akkor **tiszta illeszkedésvizsgálatról** van szó. Ilyen lehet (bár ezt a kérdést pont nem &chi;&sup2; próbával válaszoljuk meg), hogy például 100-as várható értékű és 10-es szórású normális eloszlást követ-e a változó.   

Ha a kérdés arra vonatkozik, hogy a minta feltételezhetően valamilyen *típusú* eloszlásból származik-e, amelynek paramétereit is a mintából becsüljük, akkor pedig **becsléses illeszkedésvizsgálatról** van szó. Ez utóbbi jellemzőbb, leggyakoribb formája pedig a *normalitásvizsálat*, vagyis, hogy a minta illeszkedik-e a normális eloszláshoz, de nem mi adjuk meg, hogy milyen paraméterű, hanem a mintából becsüljük a várható értéket és szórást is.

Illeszkedésvizsgálat diszkrét és folytonos változók esetében is végezhető, de mi csak a diszkrét esetet nézzük meg. Folytonos esetben, mint amilyenek a fenti példák, más próbákat, pl. Shapiro-Wilk, Kolmogorov-Smirnov, stb. tesztet végezhetünk.  


  
### Példa: kockadobás  

Vegyünk egy dobókockát. A kérdésünk, hogy feltételezhetjük-e róla, hogy szabályos. Ha szabályos, akkor a dobott számoknak illeszkedniük kell a szabályos dobókockával való dobás valószínűségeloszlásához.  
Dobunk a dobókockával 60-szor. Tegyük fel, hogy az alábbi dobások jöttek ki:  

```{r dice}
table <- hux(
  which = 1:6,
  no = c(13, 8, 10, 7, 15, 7)
)
table %>%
  set_markdown_contents(1, 1, "Dobott szám") %>%
  set_markdown_contents(1, 2, "db (m~i~)") %>%
  set_all_borders()
```

Ezek a megfigyelések, jelöljük ezeket $m_i$-vel! Most még szükségünk van az elméleti értékekre: hány 1-es, 2-es, stb. lett volna a 60 dobás között, ha *teljes mértékben* az elméleti valószínűségeloszlásnak megfelelően alakulnak a dobások. Ebben az esetben minden érték valószínűsége $P(\xi = x_i) = \frac{1}{6}$. Vagyis minden dobásból 10-nek kellett volna lennie. Általánosan:
$$e_i = N\ast p_i$$
Ebben $p_i$ egyszerűsítve jelöli az egyes értékek valószínűségét: pl. $p_1=\frac{1}{6}$ az 1-es valószínűsége.

```{r dice.complete}
e <- c(NA, rep(10, 6))
table <-  cbind(table, 
               e)
table %>%
  set_markdown_contents(1, 1, "Dobott szám") %>%
  set_markdown_contents(1, 2, "db (m~i~)") %>%
  set_markdown_contents(1, 3, "e~i~") %>%
  set_all_borders()
```

A próba értékét az alábbi képlettel kapjuk meg:  
$$\chi^{2}=\sum_{i=1}^{k}\frac{(m_{i}-e_{i})^2}{e_{i}}$$  

Ez a képlet (a megfigyelt és elméleti érték különbségének négyzete, osztva az elméleti értékkel és összeadva) ugyanaz, mint a kereszttábla esetén végzett függetlenségvizsgálaté, a különbség csak annyi, hogy illeszkedésvizsgálatnál csak egy index-szel kell dolgoznunk. A fenti táblázatra a próba értéke:  
$$\chi^{2}= \frac{(13-10)^2}{10}+\frac{(8-10)^2}{10}+\frac{(10-10)^2}{10}+ \\ +\frac{(7-10)^2}{10}+\frac{(15-10)^2}{10}+\frac{(7-10)^2}{10}=5,6$$

A próba igaz nullhipotézis (illeszkedés) esetén $df=k-1$ szabadságfokú &chi;&sup2; eloszlást követ, ahol k a változó lehetséges értékeinek a száma, vagyis a fenti esetben $df = 6 - 1 = 5$. Ehhez 5% szignifikanciaszint esetén a 11,1 határérték tartozik, vagyis 5%-os szignifikanciaszint mellett megtartjuk a nullhipotézist, nem állíthatjuk, hogy a dobások megoszlása nem illeszkedik a várt eloszláshoz, és a kockát - amíg egy másik kutatás nem valószínűsíti az ellenkezőjét - szabályosnak tekintjük. Ezért is a kettős tagadás: nem állítjuk határozottan, hogy illeszkedik, de a megfigyeléseink alapján azt sem állíthatjuk, hogy nem illeszkedik.
  


### Példa: népszámlálás

Az elméleti eloszlás származhat más forrásból is: ilyen lehet egy népszámlálás. Arra vagyunk kíváncsiak, hogy a mintánkban egy változó eloszlása illeszkedik-e a népszámlálásban látott eloszláshoz, amely az egész populáció adatait veszi alapul, tehát vehető elméletinek. Ha ebből a populációból vettük a mintát, akkor a megoszlásnak nagy valószínűséggel illeszkednie kell a teljes populációhoz.  

Vegyük a felekezeti eloszlást. A kérdésünk, hogy feltételezhetjük-e, hogy a mintánk eloszlása illeszkedik a sokasági eloszláshoz (a legutóbbi népszámlálást alapul véve). 

Tegyük fel, hogy az alábbi mintát kaptuk:  

```{r census}
table <- hux(
  which = c("Katolikus", "Református", "Evangélikus", "Egyéb", "Felekezeten kívüli"),
  no = c(490, 140, 40, 70, 260)
)
table %>%
  set_markdown_contents(1, 1, "Felekezet") %>%
  set_markdown_contents(1, 2, "db (m~i~)") %>%
  set_all_borders()
```

Az elméleti értékeket az alábbi sokasági eloszlás ($p_i$) alapján tudjuk kiszámítani az $e_i = N \ast p_i$ képlettel.

```{r census.complete}
p <- c(NA, 0.51, 0.16, 0.03, 0.05, 0.25)
e <- 1000 * p
table <-  cbind(table, p, e)
table %>%
  set_markdown_contents(1, 1, "Dobott szám") %>%
  set_markdown_contents(1, 2, "db (m~i~)") %>%
  set_markdown_contents(1, 3, "p~i~") %>%
  set_markdown_contents(1, 4, "e~i~") %>%
  set_all_borders()
```

A próba értéke:  
$$\chi^{2}=\sum_{i=1}^{k}\frac{(m_{i}-e_{i})^2}{e_{i}}=\frac{(490-510)^2}{510}+\\ + \frac{(140-160)^2}{160}+...+\frac{(260-250)^2}{250}= 15,02$$  
$$df = k-1 = 5-1=4$$
$$\chi^2_{0.95;4}=9,49$$

**Döntés:** 5%-os szignifikanciaszint mellett elvetjük a nullhipotézist, a minta felekezeti eloszlása nem illeszkedik a populáció eloszlásához. Ennek oka lehet, hogy egy másik populációból származik, vagy valami torzította a mintavételt. Elméletileg az sem kizárt, csak nagyon valószínűtlen, hogy a mi mintánk épp egy a populációtól nagyobb mértékben eltérő minta.



### Illeszkedés: folytonos változók

Ugyanígy bármilyen diszkrét valószíűségi eloszlást követő változó illeszkedése vizsgálható. Folytonos változók esetén egy lehetőség, hogy a változó értékeit intervallumokra bontjuk, és az egyes intervallumokhoz rendeljük a megfelelő valószínűségeket. Pl. Normális eloszlás esetén az átlag &plusmn; egy szórásnyi intervallumba esik az értékek harmada, stb. (Előző félévben néztük, hogyan tudunk a normális eloszláson adott valószínűségű intervallumokat lehatárolni.)  

De folytonos változók esetén rendelkezésre állnak más próbák is, mint például a *Kolmogorov-Smirnov* és az *Anderson-Darling* próba, amellyel vizsgálható a változó illeszkedése bármilyen, adott paraméterekkel rendelkező valószínűségi eloszláshoz (beleértve a kiemelt jelentőségű normális eloszlást), illetve további tesztek, mint a *Lilliefors*, *Shapiro-Wilk*, amellyel vizsgálható hogy a változó normális eloszlást követ-e.

 

## Homogenitásvizsgálat



Homogenitásvizsgálattal azt vizsgáljuk, két minta származhat-e ugyanolyan valószínűségeloszlású populációból: a két vizsgált populációban a változónak lehet-e ugyanolyan az eloszlása?  

A nullhipotézis szerint a két populációban a változó eloszlása egyforma, az ellenhipotézis szerint pedig különbözik.  

Folytonos változók esetében, akárcsak az illeszkedésvizsgálatra, erre is léteznek próbák, mint pl. a két- vagy többmintás *Kolmogorov-Smirnov* vagy *k-mintás Anderson-Darling* tesztek.  

Alacsony mérési szintű változók esetében ezúttal is $\chi^2$ tesztet végezhetünk. Létezik külön képlet a homogenitásvizsgálatra:  

$$\chi^2=N_1\ast N_2 \ast \sum_{i=1}^k \frac{\left( \frac{N_1^{(i)}}{N_1}-\frac{N_2^{(i)}}{N_2} \right)^2}{N_1^{(i)} + N_2^{(i)}} = \\ = N_1\ast N_2 \ast \sum_{i=1}^k \frac{\left(f_1^{(i)} + f_2^{(i)} \right)^2}{N_1^{(i)} + N_2^{(i)}}$$  
A képletben $N_1$ és $N_2$ a két minta teljes elemszáma, az $N_1^{(i)}$ típusú tagok pedig az adott mintában az i. kategória elemszámát jelölik, az $f_1^{(i)}$ típusú tagok pedig az adott mintában az adott kategória arányát. Általánosan:  

$$f_j^{(i)}= \frac{N_j^{(i)}}{N_j}$$

De a fenti képlet helyett használhatjuk a sima függetlenségvizsgálatnál is használt &chi;&sup2; próbát is: kiszámítjuk az $e_i$ értékeket, majd az $e_i$ és $m_i$ értékek alapján kiszámítjuk a $\chi^2$ próbát a $2\ast k$ méretű kereszttáblára, ahol $k$ a változó kategóriáinak száma.  

A próba igaz $H_0$ (homogenitás) esetén mindkét esetben $df = k-1$ szabadságfokú $\chi^2$ eloszlást követ.

Tegyük fel, hogy van két mintánk, amelyekkel egy-egy ország felekezeti megoszlását vizsgáljuk. A kérdés, hogy a felekezet változó eloszlása azonos-e a két mintában? 

```{r homogeneity}
sample1 <- c(490, 140, 40, 70, 260)
sample2 <- c(490, 100, 70, 80, 200)

table <- hux(
  which = c("Római katolikus", "Református", "Evangélikus", "Egyéb", "Felekezeten kívüli"),
  no1 = sample1,
  no2 = sample2
)
table %>%
  set_markdown_contents(1, 1, "Felekezet") %>%
  set_markdown_contents(1, 2, "1. minta") %>%
  set_markdown_contents(1, 3, "2. minta") %>%
  set_all_borders()

n1 <- sum(sample1)
n2 <- sum(sample2)

f1 <- sample1 / n1
f2 <- sample2 / n2

fractions <- NULL
for (i in 1:5) {
  fractions[i] <- sprintf("\\frac{(%.2f - %.2f)^2}{%d + %d}", f1[i], f2[i], sample1[i], sample2[i])
}

sum_fractions <- paste(fractions, collapse = "+")
```
  

**1. megoldás: a külön képlettel**

$$\chi^2=N_1\ast N_2 \ast \sum_{i=1}^k \frac{\left( \frac{N_1^{(i)}}{N_1}-\frac{N_2^{(i)}}{N_2} \right)^2}{N_1^{(i)} + N_2^{(i)}} = \\ = `r n1` \ast `r n2` \ast \left(`r sum_fractions` \right)$$